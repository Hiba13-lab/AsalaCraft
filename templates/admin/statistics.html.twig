{% extends 'base.html.twig' %}

{% block title %}Statistiques Globales - AsalaCraft{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">üìä Statistiques de la Plateforme</h1>
        <a href="{{ path('admin_dashboard') }}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left"></i> Retour au Dashboard
        </a>
    </div>

    {# 1. Cartes de r√©sum√© rapide #}
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-primary text-white text-center p-3">
                <h6 class="text-uppercase small opacity-75">Revenus Totaux</h6>
                <h3 class="fw-bold mb-0">{{ totalRevenue|number_format(2, ',', ' ') }} ‚Ç¨</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-success text-white text-center p-3">
                <h6 class="text-uppercase small opacity-75">Ventes Globales</h6>
                <h3 class="fw-bold mb-0">{{ totalOrders }}</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-info text-white text-center p-3">
                <h6 class="text-uppercase small opacity-75">Produits en ligne</h6>
                <h3 class="fw-bold mb-0">{{ totalProducts }}</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm bg-dark text-white text-center p-3">
                <h6 class="text-uppercase small opacity-75">Utilisateurs</h6>
                <h3 class="fw-bold mb-0">{{ totalUsers }}</h3>
            </div>
        </div>
    </div>

    {# 2. Zone des Graphiques #}
    <div class="row g-4">
        {# Graphique de Ventes (Ligne) #}
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm p-4 h-100">
                <h5 class="card-title mb-4">üìà √âvolution du Chiffre d'Affaires (7j)</h5>
                <div style="position: relative; height: 300px;">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>

        {# Graphique de Cat√©gories (Camembert) #}
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm p-4 h-100">
                <h5 class="card-title mb-4">üè∫ Produits par Cat√©gorie</h5>
                <div style="position: relative; height: 300px;">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- CONFIGURATION GRAPHIQUE VENTES (LINE) ---
        const ctxSales = document.getElementById('salesChart').getContext('2d');
        new Chart(ctxSales, {
            type: 'line',
            data: {
                labels: {{ labelsSales|raw }},
                datasets: [{
                    label: 'Revenus (‚Ç¨)',
                    data: {{ dataSales|raw }},
                    fill: true,
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    borderColor: '#0d6efd',
                    borderWidth: 3,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // --- CONFIGURATION GRAPHIQUE CAT√âGORIES (PIE) ---
        const ctxCat = document.getElementById('categoryChart').getContext('2d');
        new Chart(ctxCat, {
            type: 'pie',
            data: {
                labels: {{ labelsCat|raw }},
                datasets: [{
                    data: {{ dataCat|raw }},
                    backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6610f2', '#fd7e14']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    });
</script>
{% endblock %}