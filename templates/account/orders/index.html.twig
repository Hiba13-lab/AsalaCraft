{% extends 'base.html.twig' %}

{% block title %}Mon Historique de Commandes{% endblock %}

{% block body %}
    <div class="container my-5">
        <h1>Historique de Commandes</h1>
        <hr>

        {# Messages Flash (par exemple, succ√®s apr√®s la validation du checkout) #}
        {% for message in app.flashes('success') %}
            <div class="alert alert-success" role="alert">{{ message }}</div>
        {% endfor %}

        {% if orders|length > 0 %}
            <table class="table table-striped align-middle table-hover">
                <thead>
                    <tr>
                        <th>R√©f. Commande</th>
                        <th>Date</th>
                        <th>Total</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                        <tr>
                            <td>#{{ order.id }}</td>
                            <td>{{ order.createdAt|date('d/m/Y H:i') }}</td>
                            <td><span class="fw-bold">{{ order.total|number_format(2, ',', ' ') }} ‚Ç¨</span></td>
                            <td>
                                {# 
                                Les statuts de commande (CdC 7.4) sont mapp√©s √† des couleurs Bootstrap (badges).
                                - Nouvel(le), Pay√©e, En traitement, Exp√©di√©e, Termin√©e, Annul√©e
                                #}
                                {% set statusClass = {
                                    'Nouvel(le)': 'info',
                                    'Pay√©e': 'primary',
                                    'En traitement': 'primary',
                                    'Exp√©di√©e': 'warning',
                                    'Termin√©e': 'success',
                                    'Annul√©e': 'danger'
                                } %}
                                <span class="badge bg-{{ statusClass[order.status] ?? 'secondary' }} text-dark-emphasis">
                                    {{ order.status }}
                                </span>
                            </td>
                            <td>
                                {# Lien vers l'action de d√©tail de commande que nous venons de cr√©er #}
                                <a href="{{ path('app_account_order_show', {'id': order.id}) }}" class="btn btn-sm btn-outline-dark">
                                    Voir les d√©tails
                                </a>
                                
                                {# Optionnel: Lien pour t√©l√©charger la facture (√† impl√©menter plus tard) #}
                                {# <a href="{{ path('app_account_order_invoice', {'id': order.id}) }}" class="btn btn-sm btn-outline-info ms-2">
                                    Facture PDF
                                </a> #}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="text-center py-5">
                <p class="lead">Vous n'avez pas encore pass√© de commande. Commencez vos achats ! üõçÔ∏è</p>
                <a href="{{ path('app_home') }}" class="btn btn-primary">Retourner √† la boutique</a>
            </div>
        {% endif %}
    </div>
{% endblock %}